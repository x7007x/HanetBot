<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>واجهة الدردشة</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'arabic': ['IBM Plex Sans Arabic', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'fade-out': 'fadeOut 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'scale-in': 'scaleIn 0.2s ease-out',
                        'scale-out': 'scaleOut 0.2s ease-out',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes scaleOut {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0.9); opacity: 0; }
        }
        .modal-backdrop {
            backdrop-filter: blur(8px);
        }
        .button-item {
            transition: all 0.2s ease;
        }
        .button-item:hover {
            transform: translateY(-1px);
        }
        .notification {
            transition: all 0.3s ease;
        }
        .smooth-transition {
            transition: all 0.2s ease;
        }
    </style>
</head>
<body class="font-arabic bg-gray-50 min-h-screen">
    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50"></div>

    <!-- Main Container -->
    <div class="max-w-4xl mx-auto bg-white min-h-screen">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 p-4 sticky top-0 z-40">
            <div class="flex items-center justify-between">
                <h1 class="text-xl font-semibold text-gray-900">إدارة البوت</h1>
                <div class="flex gap-2">
                    <button id="saveBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg smooth-transition hover:bg-blue-600 text-sm font-medium">
                        حفظ البيانات
                    </button>
                    <!--button id="loadBtn" class="bg-gray-500 text-white px-4 py-2 rounded-lg smooth-transition hover:bg-gray-600 text-sm font-medium">
                        تحميل البيانات
                    </button-->
                </div>
            </div>
        </header>

        <!-- Content -->
        <div class="p-4 space-y-6">
            <!-- Start Message Section -->
            <div class="bg-white border border-gray-200 rounded-xl p-4">
                <h2 class="text-lg font-semibold text-gray-900 mb-3">رسالة البداية</h2>
                <textarea id="startMessage" class="w-full p-3 border border-gray-300 rounded-lg resize-none smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="أدخل رسالة البداية...">مرحباً</textarea>
            </div>

            <!-- Main Keyboard Section -->
            <div class="bg-white border border-gray-200 rounded-xl p-4">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">الأزرار الرئيسية</h2>
                    <button id="addButtonBtn" class="bg-green-500 text-white px-4 py-2 rounded-lg smooth-transition hover:bg-green-600 text-sm font-medium">
                        إضافة زر
                    </button>
                </div>
                <div id="buttonsList" class="space-y-3">
                    <!-- Buttons will be rendered here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Button Modal -->
    <div id="buttonModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50 items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-hidden animate-scale-in">
            <div class="p-4 border-b border-gray-200">
                <h3 id="modalTitle" class="text-lg font-semibold text-gray-900">إضافة زر جديد</h3>
            </div>
            <div class="p-4 overflow-y-auto max-h-[calc(90vh-120px)]">
                <div class="space-y-4">
                    <!-- Button Label -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">تسمية الزر</label>
                        <input type="text" id="buttonLabel" class="w-full p-3 border border-gray-300 rounded-lg smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="أدخل تسمية الزر">
                    </div>

                    <!-- Action Type -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">نوع الإجراء</label>
                        <select id="actionType" class="w-full p-3 border border-gray-300 rounded-lg smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="send_message">إرسال رسالة</option>
                            <option value="send_photo">إرسال صورة</option>
                            <option value="send_video">إرسال فيديو</option>
                            <option value="send_document">إرسال مستند</option>
                            <option value="send_sticker">إرسال ملصق</option>
                            <option value="send_audio">إرسال صوت</option>
                        </select>
                    </div>

                    <!-- Content Section -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">المحتوى</label>
                        <div id="contentContainer">
                            <!-- Content items will be added here -->
                        </div>
                        <button id="addContentBtn" class="mt-2 bg-blue-500 text-white px-3 py-2 rounded-lg smooth-transition hover:bg-blue-600 text-sm">
                            إضافة محتوى
                        </button>
                    </div>

                    <!-- Inline Keyboard Section -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">لوحة المفاتيح المضمنة</label>
                        <div id="inlineKeyboardContainer">
                            <!-- Inline keyboard rows will be added here -->
                        </div>
                        <button id="addInlineRowBtn" class="mt-2 bg-purple-500 text-white px-3 py-2 rounded-lg smooth-transition hover:bg-purple-600 text-sm">
                            إضافة صف
                        </button>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-200 flex gap-2 justify-end p-4">
                <button id="cancelModalBtn" class="px-4 py-2 text-gray-600 hover:text-gray-800 smooth-transition">إلغاء</button>
                <button id="saveModalBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg smooth-transition hover:bg-blue-600">حفظ</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50 items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md animate-scale-in">
            <div class="p-4">
                <h3 class="text-lg font-semibold text-gray-900 mb-2">تأكيد الحذف</h3>
                <p class="text-gray-600 mb-4">هل أنت متأكد من حذف هذا الزر؟</p>
                <div class="flex gap-2 justify-end">
                    <button id="cancelConfirmBtn" class="px-4 py-2 text-gray-600 hover:text-gray-800 smooth-transition">إلغاء</button>
                    <button id="confirmDeleteBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg smooth-transition hover:bg-red-600">حذف</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class ChatInterface {
            constructor() {
                this.data = {
                    start_message: "مرحباً",
                    main_keyboard: []
                };
                this.currentEditIndex = -1;
                this.deleteIndex = -1;
                this.init();
            }

            init() {
                this.bindEvents();
                this.renderButtons();
                document.getElementById('startMessage').value = this.data.start_message;
            }

            bindEvents() {
                // Main buttons
                document.getElementById('addButtonBtn').addEventListener('click', () => this.openButtonModal());
                document.getElementById('saveBtn').addEventListener('click', () => this.saveData());
                // document.getElementById('loadBtn').addEventListener('click', () => this.loadData());
                this.loadData();

                // Modal buttons
                document.getElementById('saveModalBtn').addEventListener('click', () => this.saveButton());
                document.getElementById('cancelModalBtn').addEventListener('click', () => this.closeButtonModal());
                document.getElementById('confirmDeleteBtn').addEventListener('click', () => this.deleteButton());
                document.getElementById('cancelConfirmBtn').addEventListener('click', () => this.closeConfirmModal());

                // Content and inline keyboard
                document.getElementById('addContentBtn').addEventListener('click', () => this.addContentItem());
                document.getElementById('addInlineRowBtn').addEventListener('click', () => this.addInlineKeyboardRow());

                // Action type change
                document.getElementById('actionType').addEventListener('change', () => this.updateContentFields());

                // Start message
                document.getElementById('startMessage').addEventListener('input', (e) => {
                    this.data.start_message = e.target.value;
                });

                // Close modals on backdrop click
                document.getElementById('buttonModal').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) this.closeButtonModal();
                });
                document.getElementById('confirmModal').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) this.closeConfirmModal();
                });
            }

            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification bg-${type === 'success' ? 'green' : 'red'}-500 text-white px-4 py-2 rounded-lg cursor-pointer animate-slide-down`;
                notification.textContent = message;
                notification.addEventListener('click', () => {
                    notification.classList.add('animate-fade-out');
                    setTimeout(() => notification.remove(), 300);
                });

                document.getElementById('notificationContainer').appendChild(notification);
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.classList.add('animate-fade-out');
                        setTimeout(() => notification.remove(), 300);
                    }
                }, 3000);
            }

            renderButtons() {
                const container = document.getElementById('buttonsList');
                container.innerHTML = '';

                this.data.main_keyboard.forEach((button, index) => {
                    const buttonElement = document.createElement('div');
                    buttonElement.className = 'button-item bg-gray-50 border border-gray-200 rounded-lg p-4';
                    buttonElement.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <h3 class="font-medium text-gray-900">${button.label}</h3>
                                <p class="text-sm text-gray-500 mt-1">الإجراء: ${this.getActionLabel(button.action)}</p>
                                <p class="text-sm text-gray-500">المحتوى: ${button.content.length} عنصر</p>
                                <p class="text-sm text-gray-500">الأزرار المضمنة: ${button.inline_keyboard.length} صف</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="chatInterface.editButton(${index})" class="bg-blue-500 text-white px-3 py-1 rounded smooth-transition hover:bg-blue-600 text-sm">
                                    تعديل
                                </button>
                                <button onclick="chatInterface.confirmDelete(${index})" class="bg-red-500 text-white px-3 py-1 rounded smooth-transition hover:bg-red-600 text-sm">
                                    حذف
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(buttonElement);
                });

                if (this.data.main_keyboard.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-8">لا توجد أزرار. اضغط "إضافة زر" لإنشاء زر جديد.</p>';
                }
            }

            getActionLabel(action) {
                const labels = {
                    'send_message': 'إرسال رسالة',
                    'send_photo': 'إرسال صورة',
                    'send_video': 'إرسال فيديو',
                    'send_document': 'إرسال مستند',
                    'send_sticker': 'إرسال ملصق',
                    'send_audio': 'إرسال صوت'
                };
                return labels[action] || action;
            }

            openButtonModal(editIndex = -1) {
                this.currentEditIndex = editIndex;
                const modal = document.getElementById('buttonModal');
                const title = document.getElementById('modalTitle');
                
                title.textContent = editIndex >= 0 ? 'تعديل الزر' : 'إضافة زر جديد';
                
                if (editIndex >= 0) {
                    this.populateModalWithButton(this.data.main_keyboard[editIndex]);
                } else {
                    this.clearModal();
                }
                
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                modal.querySelector('.bg-white').classList.add('animate-scale-in');
            }

            closeButtonModal() {
                const modal = document.getElementById('buttonModal');
                modal.querySelector('.bg-white').classList.remove('animate-scale-in');
                modal.querySelector('.bg-white').classList.add('animate-scale-out');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                    modal.querySelector('.bg-white').classList.remove('animate-scale-out');
                }, 200);
            }

            clearModal() {
                document.getElementById('buttonLabel').value = '';
                document.getElementById('actionType').value = 'send_message';
                document.getElementById('contentContainer').innerHTML = '';
                document.getElementById('inlineKeyboardContainer').innerHTML = '';
                this.updateContentFields();
            }

            populateModalWithButton(button) {
                document.getElementById('buttonLabel').value = button.label;
                document.getElementById('actionType').value = button.action;
                
                // Populate content
                const contentContainer = document.getElementById('contentContainer');
                contentContainer.innerHTML = '';
                button.content.forEach((content, index) => {
                    this.addContentItem(content, index);
                });

                // Populate inline keyboard
                const inlineContainer = document.getElementById('inlineKeyboardContainer');
                inlineContainer.innerHTML = '';
                button.inline_keyboard.forEach((row, rowIndex) => {
                    this.addInlineKeyboardRow(row, rowIndex);
                });

                this.updateContentFields();
            }

            updateContentFields() {
                const actionType = document.getElementById('actionType').value;
                const contentItems = document.querySelectorAll('.content-item');
                
                contentItems.forEach(item => {
                    const fields = item.querySelector('.content-fields');
                    fields.innerHTML = this.getContentFieldsHTML(actionType);
                });
            }

            getContentFieldsHTML(actionType) {
                switch (actionType) {
                    case 'send_message':
                        return '<input type="text" class="content-text w-full p-2 border border-gray-300 rounded smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="النص">';
                    case 'send_photo':
                        return `
                            <input type="url" class="content-photo w-full p-2 border border-gray-300 rounded mb-2 smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="رابط الصورة">
                            <input type="text" class="content-caption w-full p-2 border border-gray-300 rounded smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="التعليق (اختياري)">
                        `;
                    case 'send_video':
                        return `
                            <input type="url" class="content-video w-full p-2 border border-gray-300 rounded mb-2 smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="رابط الفيديو">
                            <input type="text" class="content-caption w-full p-2 border border-gray-300 rounded smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="التعليق (اختياري)">
                        `;
                    case 'send_document':
                        return `
                            <input type="url" class="content-document w-full p-2 border border-gray-300 rounded mb-2 smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="رابط المستند">
                            <input type="text" class="content-caption w-full p-2 border border-gray-300 rounded smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="التعليق (اختياري)">
                        `;
                    case 'send_sticker':
                        return '<input type="url" class="content-sticker w-full p-2 border border-gray-300 rounded smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="رابط الملصق">';
                    case 'send_audio':
                        return `
                            <input type="url" class="content-audio w-full p-2 border border-gray-300 rounded mb-2 smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="رابط الصوت">
                            <input type="text" class="content-caption w-full p-2 border border-gray-300 rounded smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="التعليق (اختياري)">
                        `;
                    default:
                        return '';
                }
            }

            addContentItem(content = null, index = null) {
                const container = document.getElementById('contentContainer');
                const actionType = document.getElementById('actionType').value;
                
                const contentItem = document.createElement('div');
                contentItem.className = 'content-item bg-gray-50 border border-gray-200 rounded-lg p-3 mb-2 animate-slide-up';
                contentItem.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-700">محتوى ${container.children.length + 1}</span>
                        <button onclick="this.parentElement.parentElement.remove()" class="text-red-500 hover:text-red-700 smooth-transition text-sm">حذف</button>
                    </div>
                    <div class="content-fields">
                        ${this.getContentFieldsHTML(actionType)}
                    </div>
                `;
                
                container.appendChild(contentItem);

                // Populate with existing content if provided
                if (content) {
                    setTimeout(() => {
                        this.populateContentItem(contentItem, content, actionType);
                    }, 0);
                }
            }

            populateContentItem(contentItem, content, actionType) {
                switch (actionType) {
                    case 'send_message':
                        contentItem.querySelector('.content-text').value = content.text || '';
                        break;
                    case 'send_photo':
                        contentItem.querySelector('.content-photo').value = content.photo || '';
                        contentItem.querySelector('.content-caption').value = content.caption || '';
                        break;
                    case 'send_video':
                        contentItem.querySelector('.content-video').value = content.video || '';
                        contentItem.querySelector('.content-caption').value = content.caption || '';
                        break;
                    case 'send_document':
                        contentItem.querySelector('.content-document').value = content.document || '';
                        contentItem.querySelector('.content-caption').value = content.caption || '';
                        break;
                    case 'send_sticker':
                        contentItem.querySelector('.content-sticker').value = content.sticker || '';
                        break;
                    case 'send_audio':
                        contentItem.querySelector('.content-audio').value = content.audio || '';
                        contentItem.querySelector('.content-caption').value = content.caption || '';
                        break;
                }
            }

            addInlineKeyboardRow(row = null, rowIndex = null) {
                const container = document.getElementById('inlineKeyboardContainer');
                
                const rowElement = document.createElement('div');
                rowElement.className = 'inline-row bg-gray-50 border border-gray-200 rounded-lg p-3 mb-2 animate-slide-up';
                rowElement.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-700">صف ${container.children.length + 1}</span>
                        <div class="flex gap-2">
                            <button onclick="chatInterface.addInlineButton(this.parentElement.parentElement.parentElement)" class="bg-green-500 text-white px-2 py-1 rounded text-xs smooth-transition hover:bg-green-600">إضافة زر</button>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-red-500 hover:text-red-700 smooth-transition text-sm">حذف الصف</button>
                        </div>
                    </div>
                    <div class="inline-buttons space-y-2">
                        <!-- Inline buttons will be added here -->
                    </div>
                `;
                
                container.appendChild(rowElement);

                // Populate with existing row if provided
                if (row && Array.isArray(row)) {
                    row.forEach(button => {
                        this.addInlineButton(rowElement, button);
                    });
                }
            }

            addInlineButton(rowElement, button = null) {
                const buttonsContainer = rowElement.querySelector('.inline-buttons');
                
                const buttonElement = document.createElement('div');
                buttonElement.className = 'inline-button bg-white border border-gray-300 rounded p-2 animate-slide-up';
                buttonElement.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs text-gray-600">زر مضمن</span>
                        <button onclick="this.parentElement.parentElement.remove()" class="text-red-500 hover:text-red-700 smooth-transition text-xs">حذف</button>
                    </div>
                    <div class="space-y-2">
                        <input type="text" class="inline-text w-full p-2 border border-gray-300 rounded text-sm smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="نص الزر">
                        <select class="inline-type w-full p-2 border border-gray-300 rounded text-sm smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="url">رابط</option>
                            <option value="callback_data">بيانات الاستدعاء</option>
                            <option value="switch_inline_query">استعلام مضمن</option>
                            <option value="switch_inline_query_current_chat">استعلام مضمن (الدردشة الحالية)</option>
                            <option value="web_app">تطبيق ويب</option>
                        </select>
                        <input type="text" class="inline-value w-full p-2 border border-gray-300 rounded text-sm smooth-transition focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="القيمة">
                    </div>
                `;
                
                buttonsContainer.appendChild(buttonElement);

                // Populate with existing button if provided
                if (button) {
                    setTimeout(() => {
                        buttonElement.querySelector('.inline-text').value = button.text || '';
                        buttonElement.querySelector('.inline-type').value = button.type || 'url';
                        if (button.type === 'web_app' && button.value && button.value.url) {
                            buttonElement.querySelector('.inline-value').value = button.value.url;
                        } else {
                            buttonElement.querySelector('.inline-value').value = button.value || '';
                        }
                    }, 0);
                }
            }

            saveButton() {
                const label = document.getElementById('buttonLabel').value.trim();
                const action = document.getElementById('actionType').value;

                if (!label) {
                    this.showNotification('يرجى إدخال تسمية الزر', 'error');
                    return;
                }

                // Collect content
                const content = [];
                const contentItems = document.querySelectorAll('.content-item');
                contentItems.forEach(item => {
                    const contentData = this.extractContentData(item, action);
                    if (contentData) {
                        content.push(contentData);
                    }
                });

                // Collect inline keyboard
                const inlineKeyboard = [];
                const inlineRows = document.querySelectorAll('.inline-row');
                inlineRows.forEach(row => {
                    const rowButtons = [];
                    const buttons = row.querySelectorAll('.inline-button');
                    buttons.forEach(button => {
                        const buttonData = this.extractInlineButtonData(button);
                        if (buttonData) {
                            rowButtons.push(buttonData);
                        }
                    });
                    if (rowButtons.length > 0) {
                        inlineKeyboard.push(rowButtons);
                    }
                });

                const buttonData = {
                    label,
                    action,
                    content,
                    inline_keyboard: inlineKeyboard
                };

                if (this.currentEditIndex >= 0) {
                    this.data.main_keyboard[this.currentEditIndex] = buttonData;
                    this.showNotification('تم تحديث الزر بنجاح');
                } else {
                    this.data.main_keyboard.push(buttonData);
                    this.showNotification('تم إضافة الزر بنجاح');
                }

                this.renderButtons();
                this.closeButtonModal();
            }

            extractContentData(contentItem, action) {
                switch (action) {
                    case 'send_message':
                        const text = contentItem.querySelector('.content-text')?.value.trim();
                        return text ? { text } : null;
                    case 'send_photo':
                        const photo = contentItem.querySelector('.content-photo')?.value.trim();
                        const photoCaption = contentItem.querySelector('.content-caption')?.value.trim();
                        return photo ? { photo, caption: photoCaption || '' } : null;
                    case 'send_video':
                        const video = contentItem.querySelector('.content-video')?.value.trim();
                        const videoCaption = contentItem.querySelector('.content-caption')?.value.trim();
                        return video ? { video, caption: videoCaption || '' } : null;
                    case 'send_document':
                        const document = contentItem.querySelector('.content-document')?.value.trim();
                        const docCaption = contentItem.querySelector('.content-caption')?.value.trim();
                        return document ? { document, caption: docCaption || '' } : null;
                    case 'send_sticker':
                        const sticker = contentItem.querySelector('.content-sticker')?.value.trim();
                        return sticker ? { sticker } : null;
                    case 'send_audio':
                        const audio = contentItem.querySelector('.content-audio')?.value.trim();
                        const audioCaption = contentItem.querySelector('.content-caption')?.value.trim();
                        return audio ? { audio, caption: audioCaption || '' } : null;
                    default:
                        return null;
                }
            }

            extractInlineButtonData(buttonElement) {
                const text = buttonElement.querySelector('.inline-text')?.value.trim();
                const type = buttonElement.querySelector('.inline-type')?.value;
                const value = buttonElement.querySelector('.inline-value')?.value.trim();

                if (!text || !type || !value) return null;

                if (type === 'web_app') {
                    return { text, type, value: { url: value } };
                } else {
                    return { text, type, value };
                }
            }

            editButton(index) {
                this.openButtonModal(index);
            }

            confirmDelete(index) {
                this.deleteIndex = index;
                const modal = document.getElementById('confirmModal');
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                modal.querySelector('.bg-white').classList.add('animate-scale-in');
            }

            closeConfirmModal() {
                const modal = document.getElementById('confirmModal');
                modal.querySelector('.bg-white').classList.remove('animate-scale-in');
                modal.querySelector('.bg-white').classList.add('animate-scale-out');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                    modal.querySelector('.bg-white').classList.remove('animate-scale-out');
                }, 200);
            }

            deleteButton() {
                if (this.deleteIndex >= 0) {
                    this.data.main_keyboard.splice(this.deleteIndex, 1);
                    this.renderButtons();
                    this.showNotification('تم حذف الزر بنجاح');
                    this.deleteIndex = -1;
                }
                this.closeConfirmModal();
            }

            async saveData() {
                try {
                    const response = await fetch('https://corsproxy.io/?https://hanet-bot.vercel.app/save_data', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(this.data)
                    });

                    if (response.ok) {
                        this.showNotification('تم حفظ البيانات بنجاح');
                    } else {
                        throw new Error('فشل في حفظ البيانات');
                    }
                } catch (error) {
                    this.showNotification('خطأ في حفظ البيانات: ' + error.message, 'error');
                }
            }

            async loadData() {
                try {
                    const response = await fetch('https://corsproxy.io/?https://hanet-bot.vercel.app/get_data');
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.data = data;
                        document.getElementById('startMessage').value = this.data.start_message || '';
                        this.renderButtons();
                        this.showNotification('تم تحميل البيانات بنجاح');
                    } else {
                        throw new Error('فشل في تحميل البيانات');
                    }
                } catch (error) {
                    this.showNotification('خطأ في تحميل البيانات: ' + error.message, 'error');
                }
            }
            
        }
       

        // Initialize the chat interface
        const chatInterface = new ChatInterface();
    </script>
<script>
</html>
